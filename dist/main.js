!function(t){function e(e){for(var i,a,o=e[0],u=e[1],l=e[2],h=0,c=[];h<o.length;h++)a=o[h],Object.prototype.hasOwnProperty.call(n,a)&&n[a]&&c.push(n[a][0]),n[a]=0;for(i in u)Object.prototype.hasOwnProperty.call(u,i)&&(t[i]=u[i]);for(d&&d(e);c.length;)c.shift()();return r.push.apply(r,l||[]),s()}function s(){for(var t,e=0;e<r.length;e++){for(var s=r[e],i=!0,o=1;o<s.length;o++){var u=s[o];0!==n[u]&&(i=!1)}i&&(r.splice(e--,1),t=a(a.s=s[0]))}return t}var i={},n={0:0},r=[];function a(e){if(i[e])return i[e].exports;var s=i[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,a),s.l=!0,s.exports}a.m=t,a.c=i,a.d=function(t,e,s){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(a.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)a.d(s,i,function(e){return t[e]}.bind(null,i));return s},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="";var o=window.webpackJsonp=window.webpackJsonp||[],u=o.push.bind(o);o.push=e,o=o.slice();for(var l=0;l<o.length;l++)e(o[l]);var d=u;r.push([21,1]),s()}([,,function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}i.WORLD_WIDTH=380,i.WORLD_HEIGHT=480,i.ENEMY_LIMIT_X=i.WORLD_WIDTH+100,i.ENEMY_LIMIT_Y=i.WORLD_HEIGHT+100,i.MOVE_SPEED=3,i.WALK_SPEED=1,i.DEBUG_HITBOX=!0,i.GAME_STEP_SIZE=.1,i.RANDOM_SEED="SUNFLOWER",e.default=i},function(t,e,s){"use strict";var i=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var s in t)Object.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e.default=t,e},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s(18)),a=n(s(5)),o=n(s(2)),u=s(7),l=n(s(32)),d=n(s(15)),h=s(12),c=n(s(33));e.default=new class{constructor(){this.camera=new r.Container,this.textures={},this.gameStep=0,this.liveEnemies=[],this.app=new r.Application({height:600,width:800,backgroundColor:14541549,autoStart:!1});const t=new r.Container;this.app.stage=t,this.bulletContainer=new r.Container,t.addChild(this.bulletContainer),this.unitContainer=new r.Container,t.addChild(this.unitContainer),this.loader=r.Loader.shared,this.loader.add("circle","assets/circle.png"),this.loader.add("rect","assets/rect.png"),this.loader.load(()=>{!function(t){const e=new l.default;e.x=250,e.y=100,u.installControls({[u.Button.RIGHT]:"39",[u.Button.LEFT]:"37",[u.Button.UP]:"38",[u.Button.DOWN]:"40",[u.Button.MOD]:"16"},e),t.player=e,t.unitContainer.addChild(e.sprite),e.addToScreen(),c.default(),t.app.start()}(this)});let e=0;Object.values(a.default.Pools);this.app.ticker.maxFPS=60,this.app.ticker.minFPS=30,this.manager=new d.default;let s=0;this.app.ticker.add(()=>{for(s+=this.app.ticker.elapsedMS,this.manager.execute(s),e+=this.app.ticker.deltaTime;e>=o.default.GAME_STEP_SIZE;)a.default.Pools[h.Bullet.name].forEach(t=>{t.visible&&t.update(o.default.GAME_STEP_SIZE,this.app.ticker.elapsedMS)}),this.liveEnemies.forEach(t=>{t.update(o.default.GAME_STEP_SIZE,this.app.ticker.elapsedMS)}),this.player.update(o.default.GAME_STEP_SIZE,this.app.ticker.elapsedMS),e-=o.default.GAME_STEP_SIZE,this.gameStep+=1;document.getElementById("fps").innerHTML=Math.floor(this.app.ticker.FPS).toString()})}}},,function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=s(12),r=i(s(3)),a=i(s(31));class o{static reset(t=!1){this.Pools.Bullet.forEach(t=>t.removeFromScreen())}static buildEnemy(t){const e=this.Pools[a.default.name];let s=e.find(t=>!t.visible);return void 0===s&&(s=new a.default,e.push(s),r.default.unitContainer.addChild(s.sprite)),s.setProperties(t),s.behavior=()=>{},s.addToScreen(),s}static buildBullet(t){const e=this.Pools[n.Bullet.name];let s=e.find(t=>!t.visible);return void 0===s&&(s=new n.Bullet,e.push(s),r.default.bulletContainer.addChild(s.sprite)),s.behavior=()=>{},s.setProperties(t),s.addToScreen(),s}}e.default=o,o.Pools={[n.Bullet.name]:[],[a.default.name]:[]},o.poolsKeyChanged=!1},,function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=i(s(2));var r;!function(t){t[t.NONE=0]="NONE",t[t.UP=1]="UP",t[t.DOWN=2]="DOWN",t[t.LEFT=3]="LEFT",t[t.RIGHT=4]="RIGHT",t[t.MOD=5]="MOD"}(r=e.Button||(e.Button={})),e.installedControls={},e.installControls=function(t,s){const i={};for(const[e,n]of Object.entries(t))i[n]=s.controller.handleCommand(e);Object.assign(e.installedControls,i)};e.default=class{constructor(t){this.lastX=r.NONE,this.lastY=r.NONE,this.factorX=0,this.factorY=0,this.buttons={[r.NONE]:!1,[r.UP]:!1,[r.DOWN]:!1,[r.LEFT]:!1,[r.RIGHT]:!1,[r.MOD]:!1},this.player=t}handleCommand(t){return e=>{this.buttons[t]=e}}update(){this.buttons[this.lastX]||(this.buttons[r.LEFT]?(this.factorX=-1,this.lastX=r.LEFT):this.buttons[r.RIGHT]?(this.factorX=1,this.lastX=r.RIGHT):(this.factorX=0,this.lastX=r.NONE)),this.buttons[this.lastY]||(this.buttons[r.DOWN]?(this.factorY=-1,this.lastY=r.DOWN):this.buttons[r.UP]?(this.factorY=1,this.lastY=r.UP):(this.factorY=0,this.lastY=r.NONE));const t=this.buttons[r.MOD]?n.default.WALK_SPEED:n.default.MOVE_SPEED;this.player.speedX=this.factorX*t,this.player.speedY=this.factorY*t}}},,,,,function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=i(s(3)),r=s(13),a=i(s(2));e.Bullet=class extends r.WorldObject{constructor(){super(),this.radiusSquared=64,this.radius=8}checkColision(){Math.pow(n.default.player.x-this.x,2)+Math.pow(n.default.player.y-this.y,2)<=this.radius+n.default.player.radius&&(n.default.player.onHit(this),this.removeFromScreen())}setProperties(t){t.texture=t.texture?t.texture:n.default.loader.resources.circle.texture,super.setProperties(t)}update(t,e){!this.visible||this.x>a.default.WORLD_WIDTH||this.x<0||this.y>a.default.WORLD_HEIGHT||this.y<0?this.removeFromScreen():(this.checkColision(),super.update(t,e))}}},function(t,e,s){"use strict";var i=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var s in t)Object.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e.default=t,e},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s(18)),a=n(s(2)),o=n(s(3));class u{constructor(){this._x=0,this._y=0}set x(t){this._x=t,this.sprite.x=this.x}get x(){return this._x}set y(t){this._y=t,this.sprite.y=a.default.WORLD_HEIGHT-this.y}get y(){return this._y}}e.WorldObject=class extends u{constructor(t){super(),this.speed=0,this.speedX=0,this.speedY=0,this.isEnemy=!0,this.radiusSquared=0,this.radius=0,this.angle=0,this.timeAlive=0,this.sprite=r.Sprite.from(t||r.Texture.WHITE),this.sprite.anchor.set(.5)}get visible(){return this.sprite.visible}set visible(t){this.sprite.visible=t}addToScreen(){this.visible=!0,this.timeAlive=0}updateSpeed(){this.speedX=Math.cos(this.angle)*this.speed,this.speedY=Math.sin(this.angle)*this.speed}removeFromScreen(){this.visible=!1,this.sprite.tint=16777215}move(t){this.x+=this.speedX*t,this.y+=this.speedY*t}setProperties(t){this.x=t.x,this.y=t.y,"speed"in t.speed?(this.speed=t.speed.speed,this.angle=t.speed.angle,this.updateSpeed()):(this.speedX=t.speed.x,this.speedY=t.speed.y),this.sprite.texture=t.texture?t.texture:o.default.loader.resources.rect.texture,this.radiusSquared=Math.pow(t.radius?t.radius:2,2)}behavior(){}update(t,e){this.timeAlive+=e,this.behavior(),this.move(t)}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(13);e.Unit=class extends i.WorldObject{}},function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=i(s(16));e.GameEvent=class{constructor(t,e=0,s=-1){this.repeat=e,this.repeatTime=s,this.fn=t}execute(){this.fn()}};e.default=class{constructor(){this.events={},this.timers=[]}addTimer(t){const e=n.default.sortedIndexBy(this.timers,t,t=>-t);this.timers.splice(e,0,t)}get nextTimer(){return this.timers[this.timers.length-1]}addEvent(t,e){t in this.events||(this.events[t]=[],this.addTimer(t)),this.events[t].push(e)}execute(t){for(;t>=this.nextTimer;){const t=this.timers.pop();if(void 0===t)return;this.events[t].forEach(e=>{e.execute(),e.repeat>0&&(e.repeat--,this.addEvent(t+e.repeatTime,e))}),delete this.events[t]}}}},,function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=i(s(2)),r=new(i(s(34)).default)(n.default.RANDOM_SEED);e.sleep=function(t){return new Promise(e=>setTimeout(e,t))},e.angleStep=function(t,e,s,i=n.default.WORLD_WIDTH){const r=(i-s)/e/n.default.GAME_STEP_SIZE;return Math.PI*t/r},e.randomInt=function(t,e){return r.integer({min:t,max:e})},e.randomFloat=function(t,e){return r.floating({min:t,max:e})}},,,,function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=i(s(3)),r=s(39),a=i(s(5)),o=s(7);function u(t){t.keyCode in o.installedControls&&o.installedControls[t.keyCode](!0)}function l(t){t.keyCode in o.installedControls&&o.installedControls[t.keyCode](!1)}document.addEventListener("DOMContentLoaded",function(){document.addEventListener("keydown",u,!1),document.addEventListener("keyup",l,!1),document.querySelector("#cv").appendChild(n.default.app.view)}),window.World=n.default,window.Spawner=r.Spawner,window.Factory=a.default,Object.getOwnPropertyNames(r.Spawner).filter(t=>"function"==typeof r.Spawner[t]).forEach(t=>{const e=document.createElement("button");e.onclick=()=>r.Spawner[t].bind(r.Spawner)(),e.innerHTML=t,document.getElementById("buttons").appendChild(document.createElement("br")),document.getElementById("buttons").appendChild(e)})},,,,,,,,,,function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=i(s(3)),r=s(14),a=i(s(2)),o=i(s(5));e.default=class extends r.Unit{constructor(){super(),this.attackCooldown=2e4,this.lastAttack=0}addToScreen(){super.addToScreen(),this.sprite.tint=16711680,n.default.liveEnemies.push(this)}removeFromScreen(){super.removeFromScreen();const t=n.default.liveEnemies.indexOf(this);n.default.liveEnemies.splice(t,1)}setProperties(t){this.attackCooldown=t.attackCooldown?t.attackCooldown:0,super.setProperties(t)}get canAttack(){return this.lastAttack>=this.attackCooldown}fireAtPlayer(t){this.canAttack&&(this.lastAttack=0,o.default.buildBullet({x:this.x,y:this.y,speed:{speed:t,angle:Math.atan2(n.default.player.y-this.y,n.default.player.x-this.x)}}))}fireArc(t,e,s=0,i=-Math.PI){if(!this.canAttack)return;this.lastAttack=0;const n=(i-s)/t;for(let i=0;i<t;i++){const t=s+n*i;o.default.buildBullet({x:this.x,y:this.y,speed:{speed:e,angle:t}})}}update(t,e){!this.visible||this.x>a.default.ENEMY_LIMIT_X||this.x<-100||this.y>a.default.ENEMY_LIMIT_Y||this.y<0?this.removeFromScreen():(super.update(t,e),this.lastAttack+=e)}}},function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=s(14),r=i(s(3)),a=i(s(7)),o=i(s(2));e.default=class extends n.Unit{constructor(t=0){super(r.default.loader.resources.rect.texture),this.radiusSquared=16,this.radius=4,this.isEnemy=!1,this.sprite.tint=t,this.controller=new a.default(this)}set x(t){t>o.default.WORLD_WIDTH-8?t=o.default.WORLD_WIDTH-8:t<0&&(t=0),super.x=t}get x(){return super.x}set y(t){t>o.default.WORLD_HEIGHT?t=o.default.WORLD_HEIGHT:t<12&&(t=12),super.y=t}get y(){return super.y}onHit(t){console.log("Hit!")}update(t,e){this.controller.update(),this.move(t)}}},function(t,e,s){"use strict";var i=this&&this.__awaiter||function(t,e,s,i){return new(s||(s=Promise))(function(n,r){function a(t){try{u(i.next(t))}catch(t){r(t)}}function o(t){try{u(i.throw(t))}catch(t){r(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s(function(t){t(e)})).then(a,o)}u((i=i.apply(t,e||[])).next())})},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=n(s(3)),a=s(15),o=n(s(5)),u=s(17),l=n(s(2)),d=n(s(16));function h(t,e,s,i,n,l,d,h){r.default.manager.addEvent(t,new a.GameEvent(()=>{for(let t=0;t<e.length;t++){o.default.buildEnemy({x:e[t],y:s,speed:{x:0,y:l},attackCooldown:2e4}).behavior=function(){if(this.speedY+=d,this.fireAtPlayer(h),this.speedY>=0){this.angle=Math.PI/2,this.speedX=i;const t=u.angleStep(1,i,this.x,n);this.behavior=()=>{this.fireAtPlayer(h),this.speedY=Math.sin(this.angle),this.angle-=t}}}}}))}e.default=function(){return i(this,void 0,void 0,function*(){!function(t,e){r.default.manager.addEvent(t,new a.GameEvent(()=>i(this,void 0,void 0,function*(){for(let t=0;t<e.length;t++){const s=u.randomFloat(1e-4,.003);o.default.buildEnemy({x:e[t],y:500,speed:{x:0,y:-2.5},attackCooldown:15e3}).behavior=function(){this.speedY+=s,this.speedY>=0&&(this.behavior=()=>this.fireArc(4,2,-Math.PI/4))},yield u.sleep(1500)}})))}(1e3,[300,230,50,350,180,110]);let t=500;d.default.times(10,e=>i(this,void 0,void 0,function*(){h(1e4+t*e,[330,340],500,-2,0,-2,.001,2),h(1e4+t*e,[30,40],500,2,l.default.WORLD_WIDTH,-2,.001,2)})),t=300;let e=[1e4,8e3,25e3,21580,12e3,14e3,6870,2580,7870,9999];d.default.times(10,s=>i(this,void 0,void 0,function*(){!function(t,e,s,n,u,l,d,h){r.default.manager.addEvent(t,new a.GameEvent(()=>i(this,void 0,void 0,function*(){const t=o.default.buildEnemy({x:s,y:e,speed:{x:n,y:0}});t.angle=u,t.behavior=function(){this.angle+=u,this.speedY=Math.sin(this.angle)-l,this.timeAlive>=h&&(this.fireAtPlayer(d),this.behavior=()=>{this.angle+=u,this.speedY=Math.sin(this.angle)-l})}})))}(25e3+s*t,380,0,2,.005,0,2,e[s])}))})}},,,,,,function(t,e,s){"use strict";var i=this&&this.__awaiter||function(t,e,s,i){return new(s||(s=Promise))(function(n,r){function a(t){try{u(i.next(t))}catch(t){r(t)}}function o(t){try{u(i.throw(t))}catch(t){r(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s(function(t){t(e)})).then(a,o)}u((i=i.apply(t,e||[])).next())})},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=n(s(5)),a=s(17);e.Spawner=class{static spawn(){return i(this,void 0,void 0,function*(){r.default.buildBullet({x:240,y:380,speed:{speed:1,angle:3*Math.PI/2}}).updateSpeed()})}static PsychdelicWave(t=7*Math.PI/4,e=!0,s=!0){return i(this,void 0,void 0,function*(){s&&r.default.reset();const i=.08*(e?-1:1),n=.15*(e?-1:1),o=[9699539,4915330,255,65280,16776960,16744192,16711680];for(let e=0;e<1;e++){t+=i;for(let e=0;e<16;e++){const s=t+n*e,i=240+1*Math.cos(s),u=380+1*Math.sin(s),l=r.default.buildBullet({x:i,y:u,speed:{speed:1.5,angle:s}});l.updateSpeed(),l.sprite.tint=o[e%7],yield a.sleep(50)}yield a.sleep(100)}})}static PsychdelicMadness(){return i(this,void 0,void 0,function*(){let t=7*Math.PI/4;for(let e=0;e<4;e++)this.PsychdelicWave(t,!1,!1),t-=Math.PI/2;t=7*Math.PI/4;for(let e=0;e<4;e++)this.PsychdelicWave(t,!0,!1),t+=Math.PI/2})}}}]);
//# sourceMappingURL=main.js.map